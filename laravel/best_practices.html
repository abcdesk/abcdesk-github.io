<ol class="breadcrumb">
    <li>Laravel</li>
    <li class="active">best十八个最佳实践</li>
</ol>
<h1>Laravel十八个最佳实践 </h1>
<h3>Single responsibility principle</h3>
<p>单一责任原则，一个类和一个方法应该只有一个职责。</p>
<h3>Fat models, skinny controllers</h3>
<p>强大的模型 &amp; 简单控制器，如果你使用查询构造器或原始 SQL 来查询，请将所有与数据库相关的逻辑放入 Eloquent 模型或存储库类中。</p>
<h3>Validation</h3>
<p>验证，将验证从控制器移动到请求类。</p>
<h3>Business logic should be in service class</h3>
<p>业务逻辑应该在服务类中，一个控制器必须只有一个职责，因此应该将业务逻辑从控制器移到服务类。</p>
<h3>Don't repeat yourself (DRY)</h3>
<p>不要重复你自己（DRY），尽可能重用代码。 SRP（单一职责原则）正在帮助你避免重复。当然，这也包括了 Blade 模板、Eloquent 的范围等。</p>
<h3>Prefer to use Eloquent over using Query Builder and raw SQL queries. Prefer collections over arrays</h3>
<p>最好倾向于使用 Eloquent 而不是 Query Builder 和原生的 SQL 查询。要优先于数组的集合。Eloquent 可以编写可读和可维护的代码。此外，Eloquent 也拥有很棒的内置工具，比如软删除、事件、范围等。</p>
<h3>批量赋值Mass assignment</h3>
<pre class="language-php">
$category->article()->create($request->all());
</pre>
<h3>Do not execute queries in Blade templates and use eager loading (N + 1 problem)</h3>
<p>不要在 Blade 模板中执行查询并使用关联加载（N + 1 问题），不好的地方在于，这对于100 个用户来说，等于执行 101 个 DB 查询</p>
<h3>Comment your code, but prefer descriptive method and variable names over comments</h3>
<p>与其花尽心思给你的代码写注释，还不如对方法或变量写一个描述性的名称。</p>
<h3>Do not put JS and CSS in Blade templates and do not put any HTML in PHP classes</h3>
<p>不要把 JS 和 CSS 放在 Blade 模板中，也不要将任何 HTML 放在 PHP 类中。</p>
<h3>Use config and language files, constants instead of text in the code</h3>
<p>在代码中使用配置和语言文件、常量，而不是写死它</p>
<h3>Use standard Laravel tools accepted by community</h3>
<p>使用社区接受的标准的 Laravel 工具，最好使用内置的 Laravel 功能和社区软件包，而不是其他第三方软件包和工具。</p>
<table class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th>Task</th>
            <th>Standard tools</th>
            <th>3rd party tools</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Authorization</td>
            <td>Policies</td>
            <td>Entrust, Sentinel and other packages</td>
        </tr>
        <tr>
            <td>Compiling assets</td>
            <td>Laravel Mix</td>
            <td>Grunt, Gulp, 3rd party packages</td>
        </tr>
        <tr>
            <td>Development Environment</td>
            <td>Homestead</td>
            <td>Docker</td>
        </tr>
        <tr>
            <td>Deployment</td>
            <td>Laravel Forge</td>
            <td>Deployer and other solutions</td>
        </tr>
        <tr>
            <td>Unit testing</td>
            <td>PHPUnit, Mockery</td>
            <td>Phpspec</td>
        </tr>
        <tr>
            <td>Browser testing</td>
            <td>Laravel Dusk</td>
            <td>Codeception</td>
        </tr>
        <tr>
            <td>DB</td>
            <td>Eloquent</td>
            <td>SQL, Doctrine</td>
        </tr>
        <tr>
            <td>Templates</td>
            <td>Blade</td>
            <td>Twig</td>
        </tr>
        <tr>
            <td>Working with data</td>
            <td>Laravel collections</td>
            <td>Arrays</td>
        </tr>
        <tr>
            <td>Form validation</td>
            <td>Request classes</td>
            <td>3rd party packages, validation in controller</td>
        </tr>
        <tr>
            <td>Authentication</td>
            <td>Built-in</td>
            <td>3rd party packages, your own solution</td>
        </tr>
        <tr>
            <td>API authentication</td>
            <td>Laravel Passport</td>
            <td>3rd party JWT and OAuth packages</td>
        </tr>
        <tr>
            <td>Creating API</td>
            <td>Built-in</td>
            <td>Dingo API and similar packages</td>
        </tr>
        <tr>
            <td>Working with DB structure</td>
            <td>Migrations</td>
            <td>Working with DB structure directly</td>
        </tr>
        <tr>
            <td>Localization</td>
            <td>Built-in</td>
            <td>3rd party packages</td>
        </tr>
        <tr>
            <td>Realtime user interfaces</td>
            <td>Laravel Echo, Pusher</td>
            <td>3rd party packages and working with WebSockets directly</td>
        </tr>
        <tr>
            <td>Generating testing data</td>
            <td>Seeder classes, Model Factories, Faker</td>
            <td>Creating testing data manually</td>
        </tr>
        <tr>
            <td>Task scheduling</td>
            <td>Laravel Task Scheduler</td>
            <td>Scripts and 3rd party packages</td>
        </tr>
        <tr>
            <td>DB</td>
            <td>MySQL, PostgreSQL, SQLite, SQL Server</td>
            <td>MongoDB</td>
        </tr>
    </tbody>
</table>
<h3>Follow Laravel naming conventions</h3>
<p>遵循Laravel命名约定，遵循 PSR 标准。 另外，请遵循 Laravel 社区接受的命名约定：</p>
<table class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th>What</th>
            <th>How</th>
            <th>Good</th>
            <th>Bad</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Controller</td>
            <td>singular</td>
            <td>ArticleController</td>
            <td><del>ArticlesController</del></td>
        </tr>
        <tr>
            <td>Route</td>
            <td>plural</td>
            <td>articles/1</td>
            <td><del>article/1</del></td>
        </tr>
        <tr>
            <td>Named route</td>
            <td>snake_case with dot notation</td>
            <td>users.show_active</td>
            <td><del>users.show-active, show-active-users</del></td>
        </tr>
        <tr>
            <td>Model</td>
            <td>singular</td>
            <td>User</td>
            <td><del>Users</del></td>
        </tr>
        <tr>
            <td>hasOne or belongsTo relationship</td>
            <td>singular</td>
            <td>articleComment</td>
            <td><del>articleComments, article_comment</del></td>
        </tr>
        <tr>
            <td>All other relationships</td>
            <td>plural</td>
            <td>articleComments</td>
            <td><del>articleComment, article_comments</del></td>
        </tr>
        <tr>
            <td>Table</td>
            <td>plural</td>
            <td>article_comments</td>
            <td><del>article_comment, articleComments</del></td>
        </tr>
        <tr>
            <td>Pivot table</td>
            <td>singular model names in alphabetical order</td>
            <td>article_user</td>
            <td><del>user_article, articles_users</del></td>
        </tr>
        <tr>
            <td>Table column</td>
            <td>snake_case without model name</td>
            <td>meta_title</td>
            <td><del>MetaTitle; article_meta_title</del></td>
        </tr>
        <tr>
            <td>Model property</td>
            <td>snake_case</td>
            <td>$model-&gt;created_at</td>
            <td><del>$model-&gt;createdAt</del></td>
        </tr>
        <tr>
            <td>Foreign key</td>
            <td>singular model name with _id suffix</td>
            <td>article_id</td>
            <td><del>ArticleId, id_article, articles_id</del></td>
        </tr>
        <tr>
            <td>Primary key</td>
            <td>-</td>
            <td>id</td>
            <td><del>custom_id</del></td>
        </tr>
        <tr>
            <td>Migration</td>
            <td>-</td>
            <td>2017_01_01_000000_create_articles_table</td>
            <td><del>2017_01_01_000000_articles</del></td>
        </tr>
        <tr>
            <td>Method</td>
            <td>camelCase</td>
            <td>getAll</td>
            <td><del>get_all</del></td>
        </tr>
        <tr>
            <td>Method in resource controller</td>
            <td><a href="https://laravel.com/docs/master/controllers#resource-controllers" rel="nofollow">table</a></td>
            <td>store</td>
            <td><del>saveArticle</del></td>
        </tr>
        <tr>
            <td>Method in test class</td>
            <td>camelCase</td>
            <td>testGuestCannotSeeArticle</td>
            <td><del>test_guest_cannot_see_article</del></td>
        </tr>
        <tr>
            <td>Variable</td>
            <td>camelCase</td>
            <td>$articlesWithAuthor</td>
            <td><del>$articles_with_author</del></td>
        </tr>
        <tr>
            <td>Collection</td>
            <td>descriptive, plural</td>
            <td>$activeUsers = User::active()-&gt;get()</td>
            <td><del>$active, $data</del></td>
        </tr>
        <tr>
            <td>Object</td>
            <td>descriptive, singular</td>
            <td>$activeUser = User::active()-&gt;first()</td>
            <td><del>$users, $obj</del></td>
        </tr>
        <tr>
            <td>Config and language files index</td>
            <td>snake_case</td>
            <td>articles_enabled</td>
            <td><del>ArticlesEnabled; articles-enabled</del></td>
        </tr>
        <tr>
            <td>View</td>
            <td>kebab-case</td>
            <td>show-filtered.blade.php</td>
            <td><del>showFiltered.blade.php, show_filtered.blade.php</del></td>
        </tr>
        <tr>
            <td>Config</td>
            <td>snake_case</td>
            <td>google_calendar.php</td>
            <td><del>googleCalendar.php, google-calendar.php</del></td>
        </tr>
        <tr>
            <td>Contract (interface)</td>
            <td>adjective or noun</td>
            <td>Authenticatable</td>
            <td><del>AuthenticationInterface, IAuthentication</del></td>
        </tr>
        <tr>
            <td>Trait</td>
            <td>adjective</td>
            <td>Notifiable</td>
            <td><del>NotificationTrait</del></td>
        </tr>
    </tbody>
</table>
<h3>Use shorter and more readable syntax where possible</h3>
<p>尽可能使用更短、更易读的语法</p>
<table class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th>Common syntax</th>
            <th>Shorter and more readable syntax</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>Session::get('cart')</code></td>
            <td><code>session('cart')</code></td>
        </tr>
        <tr>
            <td><code>$request-&gt;session()-&gt;get('cart')</code></td>
            <td><code>session('cart')</code></td>
        </tr>
        <tr>
            <td><code>Session::put('cart', $data)</code></td>
            <td><code>session(['cart' =&gt; $data])</code></td>
        </tr>
        <tr>
            <td><code>$request-&gt;input('name'), Request::get('name')</code></td>
            <td><code>$request-&gt;name, request('name')</code></td>
        </tr>
        <tr>
            <td><code>return Redirect::back()</code></td>
            <td><code>return back()</code></td>
        </tr>
        <tr>
            <td><code>is_null($object-&gt;relation) ? null : $object-&gt;relation-&gt;id</code></td>
            <td><code>optional($object-&gt;relation)-&gt;id</code></td>
        </tr>
        <tr>
            <td><code>return view('index')-&gt;with('title', $title)-&gt;with('client', $client)</code></td>
            <td><code>return view('index', compact('title', 'client'))</code></td>
        </tr>
        <tr>
            <td><code>$request-&gt;has('value') ? $request-&gt;value : 'default';</code></td>
            <td><code>$request-&gt;get('value', 'default')</code></td>
        </tr>
        <tr>
            <td><code>Carbon::now(), Carbon::today()</code></td>
            <td><code>now(), today()</code></td>
        </tr>
        <tr>
            <td><code>App::make('Class')</code></td>
            <td><code>app('Class')</code></td>
        </tr>
        <tr>
            <td><code>-&gt;where('column', '=', 1)</code></td>
            <td><code>-&gt;where('column', 1)</code></td>
        </tr>
        <tr>
            <td><code>-&gt;orderBy('created_at', 'desc')</code></td>
            <td><code>-&gt;latest()</code></td>
        </tr>
        <tr>
            <td><code>-&gt;orderBy('age', 'desc')</code></td>
            <td><code>-&gt;latest('age')</code></td>
        </tr>
        <tr>
            <td><code>-&gt;orderBy('created_at', 'asc')</code></td>
            <td><code>-&gt;oldest()</code></td>
        </tr>
        <tr>
            <td><code>-&gt;select('id', 'name')-&gt;get()</code></td>
            <td><code>-&gt;get(['id', 'name'])</code></td>
        </tr>
        <tr>
            <td><code>-&gt;first()-&gt;name</code></td>
            <td><code>-&gt;value('name')</code></td>
        </tr>
    </tbody>
</table>
<h3>Use IoC container or facades instead of new Class</h3>
<p>使用 IoC 容器或 facades 代替新的 Class</p>
<h3>Do not get data from the .env file directly</h3>
<p>不要直接从 .env 文件获取数据，将数据传递给配置文件，然后使用辅助函数 config() 在应用程序中使用数据。</p>
<h3>Store dates in the standard format. Use accessors and mutators to modify date format</h3>
<p>以标准格式存储日期，必要时就使用访问器和修改器来修改日期格式</p>
<h3>Other good practices</h3>
<p>其他良好做法</p>
<ul>
    <li>千万不要在路由文件中放置任何逻辑。</li>
    <li>在 Blade 模板中最小化 vanilla PHP 的使用。</li>
</ul>
<h3>参考</h3>
<ol class="reference">
    <li><a target="_blank" href="https://github.com/alexeymezenin/laravel-best-practices">https://github.com/alexeymezenin/laravel-best-practices</a></li>
    <li><a target="_blank" href="https://segmentfault.com/a/1190000015166527">https://segmentfault.com/a/1190000015166527</a></li>
    <li><a target="_blank" href="https://learnku.com/articles/12762/eighteen-best-practices-of-laravel">https://learnku.com/articles/12762/eighteen-best-practices-of-laravel</a></li>
</ol>